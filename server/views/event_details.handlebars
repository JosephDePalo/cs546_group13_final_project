<h1>Event Details - {{title}} </h1>
<a href="/report/event/{{_id}}" class="btn btn-warning">
  Report Event
</a>
<div class="actions">
  {{#if isRegistered}}
  <button id="register-btn" data-event-id="{{_id}}" class="btn btn-danger">
    Unregister
  </button>
  {{else}}
  <button id="register-btn" data-event-id="{{_id}}" class="btn btn-primary">
    Register
  </button>
  {{/if}}

  <div id="register-error"></div>

</div>

<section class="event-details">

  <h2>Overview</h2>

  <div class="detail-item">
    <span class="detail-label">Title</span>
    <p class="detail-value">{{title}}</p>
  </div>

  <div class="detail-item">
    <span class="detail-label">Description</span>
    <p class="detail-value">{{description}}</p>
  </div>

  <div class="detail-item">
    <span class="detail-label">Start Time</span>
    <time class="detail-value" datetime="{{start_time}}">
      {{formatted_start_time}}
    </time>
  </div>

  <div class="detail-item">
    <span class="detail-label">End Time</span>
    <time class="detail-value" datetime="{{end_time}}">
      {{formatted_end_time}}
    </time>
  </div>

  <div class="detail-item">
    <span class="detail-label">Max Capacity</span>
    <p class="detail-value">{{max_capacity}}</p>
  </div>

  <h2>Other</h2>

  <div class="detail-item">
    <span class="detail-label">Address</span>
    <p class="detail-value">{{address}}</p>
  </div>

  <div class="detail-item">
    <span class="detail-label">City</span>
    <p class="detail-value">{{city}}</p>
  </div>

  <div class="detail-item">
    <span class="detail-label">State</span>
    <p class="detail-value">{{state}}</p>
  </div>

  <div class="detail-item">
    <span class="detail-label">Location URL</span>
    <p class="detail-value">
      <a href="{{location_url}}" target="_blank" rel="noopener">
        {{location_url}}
      </a>
    </p>
  </div>

</section>


<hr>

{{!-- ===================== COMMENTS ===================== --}}

<section class="comments-section">

  <h2>Comments</h2>

  {{!-- Comment Form --}}
  {{> comment_form event=this user=user}}

  <hr>

  {{!-- Comment List --}}
  <div class="comment-list">
    {{#if comments.length}}
    {{#each comments}}
    {{> comment_item this user=../user}}
    {{/each}}
    {{else}}
    <p>No comments yet.</p>
    {{/if}}
  </div>

</section>


<div class="actions">
  {{#if is_owner_or_admin}}
  <a href="/event/manage/{{_id}}" class="btn btn-primary">
    Edit Event
  </a>
  {{/if}}

  <a href="/events" class="btn btn-primary">
    Back to Events
  </a>
</div>

{{!-- ===================== SCRIPTS ===================== --}}
<script src="/js/eventreg.clientside.js"></script>
<script src="/js/comment.validation.js"></script>

<script>
  /**
   * Reply button handler
   * Fit for AJAX
   */
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.reply-btn');
    if (!btn) return;

    const parentId = btn.dataset.parentId;
    const parentInput = document.getElementById('parent_comment_id');
    const contentInput = document.getElementById('content');

    if (parentInput && contentInput) {
      parentInput.value = parentId;
      contentInput.focus();
    }

    contentInput.focus();
    contentInput.scrollIntoView({
      behavior: 'smooth',
      block: 'center'
    });
  });
</script>
